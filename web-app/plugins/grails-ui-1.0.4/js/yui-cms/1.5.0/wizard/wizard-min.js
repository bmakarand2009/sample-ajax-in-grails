/*
Copyright (c) 2007, Caridy Patino. All rights reserved.
Portions Copyright (c) 2007, Yahoo!, Inc. All rights reserved.
Code licensed under the BSD License:
http://www.bubbling-library.com/eng/licence
version: 1.5.0
*/
(function(){var $L=YAHOO.lang,$C=YAHOO.util.Connect,$E=YAHOO.util.Event,$D=YAHOO.util.Dom,$=YAHOO.util.Dom.get,$DP=YAHOO.plugin.Dispatcher;YAHOO.plugin.WizardManager=function(){var obj={},_areas={},_className='yui-cms-wizard',_formClass='yui-cms-form',_dynamic='dynamic',_loadingClass='loading',_form_control='yuicmswizard',_defConf={status:false,handle:null,uri:null,morePostDate:{},onCancel:null,onReady:null,onFinish:null,onSubmit:null,values:{}};var callback={success:function(o){var area=o.argument.area;$DP.process(area.element,o.responseText,{onStart:function(){},error:function(){onError(area);},onLoad:function(){$D.removeClass(area.element,_loadingClass);if(area.values._wizardfinish){onFinish(area);}else if(area.values._wizardcancel){onCancel(area);}check(area);},firewall:area.firewall},true);},failure:function(o){onError(o.argument.area);}};function fetch(config,m,uri,c){$D.addClass(config.element,_loadingClass);uri=$DP.firewall(uri,config);if($L.isFunction(config.onStart)){config.onStart.apply(config,[config.values]);config.onStart=null;}if(YAHOO.Bubbling){YAHOO.Bubbling.fire('onAsyncRequestStart',{element:config.element});}config.handle=$C.asyncRequest(m,uri,c);}function check(area){var items=[],sName,k,bt,label,f,c;if($L.isObject(area)&&$L.isObject(area.element)){if(!area.overheat){items=[];items.merge(area.element.getElementsByTagName('button'));for(k=0;k<items.length;k++){if(!$D.getAncestorByClassName(items[k],'yui-button')){bt=new YAHOO.widget.Button(items[k],{className:items[k].className});}}items=[];items.merge(area.element.getElementsByTagName('input'));for(k=0;k<items.length;k++){bt=items[k].getAttribute('type').toLowerCase();label=items[k].getAttribute('value');if($L.isObject(YAHOO.widget.Button)&&((bt=='submit')||(bt=='reset')||(bt=='button'))){label='<div class="i">'+label+'</div>';bt=new YAHOO.widget.Button(items[k],{label:label,className:items[k].className});}}}items=[];items.merge(area.element.getElementsByTagName('form'));for(k=0;k<items.length;k++){f=items[k];if(!$D.hasClass(f,_formClass)){$D.addClass(f,_formClass);area.morePostData[_form_control]=area.id;var cc={upload:callback.success,success:callback.success,failure:callback.failure,argument:{area:area}};$E.on(f,"submit",function(e){var sName=null,uri=f.getAttribute("action",2)||area.uri,m=(f.getAttribute('method').toLowerCase()=='post'?'POST':'GET');$C._formNode=f;for(sName in area.morePostData){if(area.morePostData.hasOwnProperty(sName)){$C.appendPostData(sName+'='+area.morePostData[sName]);}}onSubmit(area);if($L.isObject(YAHOO.widget.Button)){YAHOO.widget.Button.addHiddenFieldsToForm(f);}if(!$D.hasClass(f,'yui-cms-simpleform')){uri=$DP.augmentURI(uri,area.moreGetData);$C.setForm(f,$D.hasClass(f,'yui-cms-upload'));fetch(area,m,uri,cc);$C.resetFormState();$E.stopEvent(e);}});}}area.status=true;onReady(area);}}function reset(area,uri){var i,m='';uri=new String($L.isString(uri)?uri:area.uri);uri+=((uri.indexOf('?')==-1)?'?':'&')+_form_control+'='+area.id;uri=$DP.augmentURI(uri,area.moreGetData);if($L.isObject(area)&&$L.isObject(area.element=$(area.id))&&uri){var cc={success:callback.success,failure:callback.failure,argument:{area:area}};fetch(area,'GET',uri,cc);}}var onSubmit=function(area){if($L.isFunction(area.onSubmit)){area.onSubmit.apply(area,[area.values]);}};var onFinish=function(area){if($L.isFunction(area.onFinish)){area.onFinish.apply(area,[area.values]);}};var onCancel=function(area){if($L.isFunction(area.onCancel)){area.onCancel.apply(area,[area.values]);}};var onError=function(area){if($L.isFunction(area.onError)){area.onError.apply(area,[area.values]);}};var onReady=function(area){if($L.isFunction(area.onReady)){area.onReady.apply(area,[area.values]);}};obj.getStatus=function(id){if($L.isObject(_areas[id])){return _areas[id].status;}return false;};obj.getValues=function(id){if(this.getStatus(id)){return _areas[id].values;}return false;};obj.setValues=function(id,enc){if(this.getStatus(id)){var area=_areas[id];try{area.values=$L.JSON.parse(enc);}catch(e){onError(area);}return area.values;}return null;};obj.jump=function(id,uri){if(this.getStatus(id)){reset(_areas[id],uri);return true;}return false;};obj.init=function(id,userConfig){var c=userConfig||_defConf;if($L.isObject(id)){id=$E.generateId(id);}if($L.isObject(_areas[id])){$L.augmentObject(c,_areas[id],true);}c.morePostData=c.morePostData||{};c.moreGetData=c.moreGetData||{};if($L.isObject(c.dataMask)){$L.augmentObject(c.morePostData,c.dataMask,true);$L.augmentObject(c.moreGetData,c.dataMask,true);}if(c.dynamic){$D.addClass(c.id,_dynamic);}$D.addClass(c.id,_className);_areas[c.id]=c;return c;};obj.add=function(id,userConfig){var c=userConfig||_defConf,el=c.id||id||c.element;if($L.isString(el)&&(el!=='')){el=$(el);}if($L.isObject(el)&&$L.isString(c.uri)&&(c.uri!=='')){c.id=$E.generateId(el);c.element=el;c.handle=null;c.status=false;c.values={};this.remove(c.id);this.init(id,c);reset(_areas[id]);}return _areas[id];};obj.adopt=function(id,userConfig){var c=userConfig||_defConf,el=c.id||id||c.element;if($L.isString(el)&&(el!=='')){el=$(el);}if($L.isObject(el)){c.id=$E.generateId(el);c.element=el;c.handle=null;c.status=false;c.values={};this.remove(c.id);this.init(id,c);check(_areas[c.id]);}return _areas[id];};obj.delegate=function(tab,tabview,config){config=config||{};config.action='tabview';config.uri=tab.get('dataSrc')||null;config.tab=tab;config.moreGetData=config.moreGetData||{};if($L.isObject(config.dataMask)){$L.augmentObject(config.moreGetData,config.dataMask,true);}tab.set('dataSrc',$DP.augmentURI(config.uri,config.moreGetData));tab.loadHandler.success=function(o){var el=tab.get('contentEl');config.tab=el;config.underground=true;$DP.process(tab,o.responseText,config);$D.addClass(el,_dynamic);obj.adopt(el,config);if(YAHOO.Bubbling){YAHOO.Bubbling.fire('onAsyncRequestEnd',{element:el});}};tab.on("activeChange",function(){if(YAHOO.Bubbling&&this.get('active')&&tab.get('dataSrc')&&!this.get('cacheData')){YAHOO.Bubbling.fire('onAsyncRequestStart',{element:this.get('contentEl')});}});if($L.isObject(tabview)){tabview.addTab(tab);}};obj.remove=function(id){if($L.isObject(id)){id=$E.generateId(id);}if(id&&(_areas[id])){_areas[id].handle=null;_areas[id]=null;}_areas[id]=[];};obj.reload=function(id,uri){if($L.isObject(id)){id=$E.generateId(id);}if(id&&(_areas[id])){reset(_areas[id],uri);}};return obj;}();})();Array.prototype.merge=function(items){var i;for(i=0;i<items.length;i++){this.push(items[i]);}};
YAHOO.util.WizardManager=YAHOO.plugin.WizardManager;
YAHOO.register("wizard",YAHOO.plugin.WizardManager,{version:"1.5.0",build:"227"});